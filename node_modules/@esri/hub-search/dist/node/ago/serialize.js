"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.isFilterable = exports.serialize = void 0;
const filters_1 = require("./helpers/filters");
/**
 * ```
 * serialize raw query parameters into hub specific URI encoding
 * Example:
 * Input: { q: 'crime', tags: 'a,b,c', sort: 'name' }
 * Output: 'q=crime&tags=all(a,b,c)&sort=name'
 * ```
 * @export
 * @param {ISearchParams} searchParams
 * @returns {string}
 */
function serialize(searchParams) {
    // 1. handle filterable params like tags, source, hasApi, groupIds since they follow custom logic
    const filters = filters_1.createFilters(searchParams);
    const encodedFilters = filters_1.encodeFilters(filters);
    // 2. handle non-filters like q, sort etc which have <string: string> type and also nested types like page, agg.
    // extract non-filterable fields from search params
    const nonFilterKeys = Object.keys(searchParams).filter(param => !isFilterable(param));
    const nonFilterSearchParams = {};
    nonFilterKeys.forEach(key => {
        nonFilterSearchParams[key] = searchParams[key];
    });
    const encodedNonFilters = filters_1.encodeParams(nonFilterSearchParams);
    const parts = [];
    // don't include blank strings in the URI encoding
    if (encodedNonFilters)
        parts.push(encodedNonFilters);
    if (encodedFilters)
        parts.push(encodedFilters);
    return parts.join("&");
}
exports.serialize = serialize;
function isFilterable(field) {
    return filters_1.filterSchema[field] && filters_1.filterSchema[field].type === "filter";
}
exports.isFilterable = isFilterable;
//# sourceMappingURL=serialize.js.map