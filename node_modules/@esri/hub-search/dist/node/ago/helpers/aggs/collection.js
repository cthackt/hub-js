"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.collectionAgg = void 0;
const hub_common_1 = require("@esri/hub-common");
// implements the 'collection' facet from AGO results. V3 datasets have this property computed
// during the harvesting process but AGO results need this result computed at runtime
/**
 * Calculate raw counts for collection based on AGO type aggregations
 * @param agoAggregations aggregations from ago results
 */
function collectionAgg(agoAggregations = {}) {
    const typeAggs = (hub_common_1.getProp(agoAggregations, "counts") || []).filter((agg) => agg.fieldName === "type")[0];
    if (!typeAggs)
        return { collection: {} };
    return typeAggs.fieldValues.reduce((formattedAggs, fieldVal) => {
        const category = hub_common_1.getCategory(fieldVal.value);
        let collectionType;
        if (category) {
            // upper case first letter and return as element in array for backwards compatibility
            collectionType = category
                .toLowerCase()
                .split(" ")
                .map((word) => word.charAt(0).toUpperCase() + word.slice(1))
                .join(" ");
        }
        else {
            collectionType = "Other";
        }
        formattedAggs.collection[collectionType] = fieldVal.count;
        return formattedAggs;
    }, { collection: {} });
}
exports.collectionAgg = collectionAgg;
//# sourceMappingURL=collection.js.map