"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.generateFilter = exports.createFilters = void 0;
const filter_schema_1 = require("./filter-schema");
/**
 * Create filters object based on raw params like tags=a,b or tags=any(a,b)
 *
 * @param {ISearchParams} params
 * @returns {any}
 */
// return a standard filter object
// given a query string that looks like this:
//
// ?tags=tag1,tag2&source=source1,source2
//
// This function will return a filter like:
//
// {
//   filter: {
//     tags: {
//       fn: 'all',
//       terms: [ 'tag1', 'tag2' ]
//     },
//     source: {
//       fn: 'any',
//       terms: [ 'source1', 'source2' ]
//     }
//   }
// }
function createFilters(params) {
    if (!params) {
        return {};
    }
    const filter = Object.keys(params).reduce((filters, key) => {
        const filterDefinition = filter_schema_1.filterSchema[key] || {};
        if (params[key] &&
            filterDefinition.type === "filter" &&
            filterDefinition.dataType) {
            const values = params[key];
            filters[key] = generateFilter(values, filterDefinition);
        }
        return filters;
    }, {});
    return filter;
}
exports.createFilters = createFilters;
function generateFilter(values, filterDefinition) {
    const match = values.match(/(any|all|between)\((.+)\)/);
    if (match) {
        return {
            fn: match[1],
            terms: match[2].split(","),
            catalogDefinition: filterDefinition.catalogDefinition
        };
    }
    else {
        return {
            fn: filterDefinition.defaultOp || null,
            terms: values.split(","),
            catalogDefinition: filterDefinition.catalogDefinition
        };
    }
}
exports.generateFilter = generateFilter;
//# sourceMappingURL=create-filters.js.map