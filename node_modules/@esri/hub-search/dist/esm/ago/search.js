/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.
 * Apache-2.0 */
import { __awaiter, __generator } from "tslib";
import { computeItemsFacets } from "./compute-items-facets";
import { agoFormatItemCollection } from "./format-item-collection";
import { getItems } from "./get-items";
/**
 * Search for Items in ArcGIS, compute facets and format the response into V3 like datasets
 *
 * @export
 * @param {ISearchParams} params (query params from hub indexer)
 * @param {UserSession} authentication
 * @returns {Promise<ISearchResult>}
 */
export function agoSearch(params, token, portal, authentication) {
    return __awaiter(this, void 0, void 0, function () {
        var agoResponse, facets, model;
        return __generator(this, function (_a) {
            switch (_a.label) {
                case 0: return [4 /*yield*/, getItems(params, token, portal, authentication)];
                case 1:
                    agoResponse = _a.sent();
                    return [4 /*yield*/, computeItemsFacets(agoResponse.aggregations, params, token, portal)];
                case 2:
                    facets = _a.sent();
                    model = agoFormatItemCollection(agoResponse, facets, params);
                    return [2 /*return*/, model];
            }
        });
    });
}
//# sourceMappingURL=search.js.map