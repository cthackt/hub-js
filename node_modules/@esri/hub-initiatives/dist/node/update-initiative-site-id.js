"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.updateInitiativeSiteId = void 0;
const hub_common_1 = require("@esri/hub-common");
const arcgis_rest_portal_1 = require("@esri/arcgis-rest-portal");
/**
 * Update the Site associated with an Initiative by setting the
 * `item.properties.siteId` to a new value
 *
 * Used during createSite(...) and any time we need to
 * connect a different Site to an Initiative
 *
 * @param initiativeItemId string | IItem | IModel
 * @param siteId string
 * @param hubRequestOptions IHubRequestOptions
 */
function updateInitiativeSiteId(maybeModel, siteId, hubRequestOptions) {
    // assume it's an IItem
    let itemPromise = Promise.resolve(maybeModel);
    // if we got a string, treat it as an id
    if (typeof maybeModel === "string") {
        if (!hub_common_1.isGuid(maybeModel)) {
            return Promise.reject(new Error("updateInitiativeSiteId was passed a string that is not a GUID."));
        }
        else {
            itemPromise = arcgis_rest_portal_1.getItem(maybeModel, {
                authentication: hubRequestOptions.authentication
            });
        }
    }
    else {
        // if it's an IModel it will have `.item.id` defined
        if (hub_common_1.getProp(maybeModel, "item.id")) {
            const m = maybeModel;
            itemPromise = Promise.resolve(m.item);
        }
    }
    // kick off the promise that will return an IItem
    return itemPromise.then((item) => {
        // oddly, IItem does not have .properties even as an optional O_o
        // regardless, ensure .properties exists
        if (!item.properties) {
            item.properties = {};
        }
        // set the siteId
        item.properties.siteId = siteId;
        // and... update the item
        return arcgis_rest_portal_1.updateItem({
            item,
            authentication: hubRequestOptions.authentication
        });
    });
}
exports.updateInitiativeSiteId = updateInitiativeSiteId;
//# sourceMappingURL=update-initiative-site-id.js.map